{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Food Delivery</title>
    <!--  Links -->
     
  <link rel="icon" type="image/png" sizes="96x96" href="{% static 'images/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}"> {# Assuming a 32x32 version exists #}
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}"> {# Assuming a 16x16 version exists #}

    {# Apple Touch Icon for iOS devices #}
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}">

    {# Older .ico format for broader compatibility (contains multiple sizes) #}
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}">

    {# Web App Manifest for Progressive Web Apps (PWAs) #}
    <link rel="manifest" href="{% static 'images/site.webmanifest' %}">

    {# Mask Icon for Safari pinned tabs (requires an SVG, assuming you have one) #}
    <link rel="mask-icon" href="{% static 'images/safari-pinned-tab.svg' %}" color="#5bbad5">

    {# Meta tags for Windows Tile and Theme Color #}
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">


  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  {% block extra_css %}{% endblock %}
</head>

<body>
<!-- ✅ Navbar -->
<div id="notification" class="notification"></div>

<nav class="navbar">
  <div class="logo">Food Delivery</div>

  <div class="nav-links">
    <a href="{% url 'home' %}" class="{% if request.path == '/' %}active{% endif %}">Home</a>
    <a href="{% url 'food' %}" class="{% if request.path == '/food/' %}active{% endif %}">Menu</a>
    <a href="{% url 'restaurant' %}" class="{% if request.path == '/restaurant/' %}active{% endif %}">Restaurant</a>
    <a href="{% url 'contact_us' %}" class="{% if request.path == '/contact-us/' %}active{% endif %}">Contact Us</a>
  </div>

  <div class="navbar-actions">
    <div class="search-box">
      <form action="{% url 'product_search' %}" method="get">
        <input type="text" name="q" placeholder="Search products..." />
        <button type="submit"><i class="fas fa-search"></i></button>
      </form>
    </div>

    <a href="{% url 'cart' %}" class="cart-icon">
      <i class="fas fa-shopping-cart"></i><sup id="cart-count">0</sup>
    </a>

    {% if user.is_authenticated %}
      <div class="profile-dropdown">
        <img src="{% static 'images/avatar.jpg' %}" alt="avatar" class="avatar" onclick="toggleProfileDropdown()" />
        <div id="profileDropdown" class="dropdown-content">
          <a href="{% url 'my_orders' %}">My Orders</a>
          {% if user.profile.role == 'seller' %}
            <a href="{% url 'seller_dashboard' %}">Seller Dashboard</a>
          {% endif %}
          <a href="{% url 'logout' %}">Logout</a>
        </div>
      </div>
    {% else %}
      <a href="{% url 'login' %}" class="login-btn">Login</a>
    {% endif %}
  </div>
</nav>


  <!-- Main Content -->
  {% block content %}
  {% endblock %}

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-container">

      <div class="footer-column company">
        <h3>Food Delivery</h3>
        <p class="tagline">"We deliver fresh Foods straight to your door."</p>
        <p class="desc">Trusted by thousands to make delivery easy and affordable.</p>
      </div>
      <div class="footer-column contact">
        <h4>Contact Us</h4>
        <ul>
          <li><i class="fas fa-map-marker-alt"></i> Addis Ababa, Ethiopia</li>
          <li><i class="fas fa-phone-alt"></i> +251 123 456 789</li>
          <li><i class="fas fa-envelope"></i>
          </ul>
      </div>

      <div class="footer-column links">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="{%url 'home'%}">Home</a></li>
          <li><a href="{%url 'food'%}">Meanu</a></li>
          <li><a href="{%url 'restaurant'%}">Restaurant</a></li>
          <li><a href="{%url 'contact_us'%}">Contact Us</a></li>
        </ul>
      </div>

      <div class="footer-column help">
        <h4>Need Help?</h4>
        <ul>
          <li><a href="#">Delivery Information</a></li>
          <li><a href="#">Return & Refund Policy</a></li>
          <li><a href="#">Payment Methods</a></li>
          <li><a href="#">Track your Order</a></li>
          <li><a href="#">Contact Us</a></li>
        </ul>
      </div>

      <div class="social-links">
        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
        <a href="#" class="social-icon"><i class="fab fa-whatsapp"></i></a>
        <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
      </div>

    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 Food Delivery. All rights reserved.</p>
    </div>
  </footer>

...
<!-- All your content above -->
<footer class="footer"> ... </footer>

<!-- Place it here, BEFORE </body> -->
<script>
  // --- Always use numeric id as the cart key ---
  function getCart() {
    try { return JSON.parse(localStorage.getItem('cart')) || {}; } catch { return {}; }
  }
  function saveCart(cart) { localStorage.setItem('cart', JSON.stringify(cart)); }

  // Normalize any legacy keys like "burger-0" -> "12"
  function normalizeCartKeys() {
    const cart = getCart();
    let changed = false;
    for (const [key, item] of Object.entries(cart)) {
      // if item already has numeric id and key matches it, skip
      if (item && Number.isInteger(Number(item.id)) && String(item.id) === key) continue;

      // prefer item.id if numeric
      let newKey = null;
      if (item && Number.isInteger(Number(item.id))) {
        newKey = String(Number(item.id));
      } else {
        // fallback: extract digits from old key
        const m = String(key).match(/\d+/);
        if (m) {
          newKey = String(Number(m[0]));
          item.id = Number(newKey);
        }
      }
      if (newKey && newKey !== key) {
        cart[newKey] = item;
        delete cart[key];
        changed = true;
      } else if (!item.id) {
        // mark invalid item to avoid future errors
        item.id = null;
      }
    }
    if (changed) saveCart(cart);
  }

  function updateCartCount() {
    const cart = getCart();
    const total = Object.values(cart).reduce((s, it) => s + (Number(it.quantity) || 0), 0);
    const el = document.getElementById('cart-count');
    if (el) el.textContent = total;
  }

  function showNotification(message = "✅ Product added to cart!") {
    const el = document.getElementById('notification');
    if (!el) return;
    el.textContent = message;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2500);
  }

  document.addEventListener('DOMContentLoaded', function () {
    normalizeCartKeys();           // <--- run once
    updateCartCount();

    document.querySelectorAll('.card .add-to-cart').forEach((btn) => {
      btn.addEventListener('click', function (e) {
        // prevent navigating to the <a> around the card
        e.preventDefault();
        e.stopPropagation();

        const id = Number(btn.dataset.id);
        const name = btn.dataset.name || '';
        const price = Number(btn.dataset.price || 0);
        const image = btn.dataset.image || '';

        if (!Number.isInteger(id)) {
          console.warn('Invalid product id on button:', btn.dataset.id);
          showNotification('❌ Unable to add item (invalid id)');
          return;
        }

        const cart = getCart();
        const key = String(id); // key = REAL numeric id

        if (!cart[key]) {
          cart[key] = { id, name, price, image, quantity: 0 };
        }
        cart[key].quantity += 1;

        saveCart(cart);
        updateCartCount();
        showNotification(`✅ ${name} added to cart!`);
      });
    });
  });
    // --- Dropdown Avatar Profile (no change) ---
  function toggleProfileDropdown() {
    document.getElementById("profileDropdown").classList.toggle("show");
  }
  window.onclick = function(event) {
    if (!event.target.classList.contains('avatar')) {
      var dropdowns = document.getElementsByClassName("dropdown-content");
      for (var i = 0; i < dropdowns.length; i++) {
        dropdowns[i].classList.remove('show');
      }
    }
  }

  // (unchanged dropdown code if you had it)
</script>

</body>
</html>


